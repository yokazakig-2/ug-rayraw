{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Introduction","text":""},{"location":"#yaenami","title":"YAENAMI","text":"<p>YAENAMI is an ASIC developed by the KEK IPNS E-sys; it has sophisticated functionalities to readout SiPMs such as bias adjusting DAC, pre-amplifier, shaper, comparator, and waveform digitizer ADC. The feature of YAENAMI is that it can digitize a incoming signal waveform with 10-bit steps and 100 MSps in maximum.</p>"},{"location":"#rayraw","title":"RAYRAW","text":"<p>RAYRAW is a general purpose multi-SiPM readout board with 4 YAENAMIs, which readout 32 (8x4) channels.</p>"},{"location":"#version-1","title":"Version 1","text":"<p>This was designed as a test bench to evaluate YAENAMI ASICs. An FPGA firmware dedicated for a triggered-type DAQ system is implemented, but the board has functions to be operated as a trigger-less data-streaming mode. A part of the board design is common to that of CIRASAME and AMANEQ.</p>"},{"location":"#links","title":"Links","text":"<ul> <li>Open-It CIRASAME project</li> </ul>"},{"location":"#update-history","title":"Update history","text":"<p>2024.12</p> <ul> <li>Descriptions for Hardware, synchronization, firmware, software, and practical usage</li> </ul>"},{"location":"asic/yaenami/","title":"YAENAMI ASIC","text":"<p>\u3053\u3053\u306bASIC\u306e\u8a18\u8ff0\u3092\u66f8\u304f</p>"},{"location":"asic/yaenami/#overview","title":"Overview","text":""},{"location":"asic/yaenami/#functions","title":"Functions","text":""},{"location":"asic/yaenami/#spi-registers","title":"SPI registers","text":""},{"location":"asic/yaenami/#difference-among-v1-v2-and-v3","title":"Difference among v1, v2, and v3","text":""},{"location":"asic/yaenami/#precautions-for-use","title":"Precautions for use","text":""},{"location":"firmware/overview/overview/","title":"Overview","text":"<p>RAYRAW\u306e\u30d5\u30a1\u30fc\u30e0\u30a6\u30a7\u30a2\u306fAMANEQ\u540c\u69d8\u3001Hadron Universal Logic module (HUL)\u3092\u5143\u306b\u3057\u3066\u3044\u308b\u3002 RAYRAW\u30d5\u30a1\u30fc\u30e0\u30a6\u30a7\u30a2\u306e\u57fa\u672c\u69cb\u9020\u3092\u4e0b\u56f3\u306b\u793a\u3059\u3002 \u56db\u89d2\u3067\u56f2\u307e\u308c\u305f\u6587\u5b57\u306f\u30d5\u30a1\u30fc\u30e0\u30a6\u30a7\u30a2\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u3001\u30e2\u30b8\u30e5\u30fc\u30eb\u3068\u77e2\u5370\u3067\u7e4b\u304c\u3063\u3066\u3044\u308b\u56f2\u3044\u306e\u306a\u3044\u6587\u5b57\u306f\u30cf\u30fc\u30c9\u30a6\u30a7\u30a2\u3092\u8868\u3059\u3002 \u30d5\u30a1\u30fc\u30e0\u30a6\u30a7\u30a2\u306e\u76e3\u8996\u30fb\u5236\u5fa1 (\u6e29\u5ea6\u306e\u8aad\u307f\u51fa\u3057\u3084\u96fb\u5727\u8abf\u6574\u306a\u3069) \u304a\u3088\u3073\u30c7\u30fc\u30bf\u8aad\u307f\u51fa\u3057\u306fSiTCP\u3092\u901a\u3058\u3066PC\u304b\u3089\u884c\u308f\u308c\u308b\u3002 \u524d\u8005\u306f\u30b9\u30ed\u30fc\u30b3\u30f3\u30c8\u30ed\u30fc\u30eb\u3068\u547c\u3070\u308c\u3001\u5404\u30e2\u30b8\u30e5\u30fc\u30eb\u3068\u306e\u4fe1\u53f7\u306e\u9001\u53d7\u4fe1\u306fLocal Bus\u3092\u901a\u3057\u3066\u3001Local Bus Controller (BCT) \u306b\u3088\u308a\u5236\u5fa1\u3055\u308c\u308b\u3002 \u30c7\u30fc\u30bf\u53d6\u5f97\u306fTrigger Manager (TRM) \u304c\u767a\u884c\u3059\u308b\u30c8\u30ea\u30ac\u30fc\u3092\u6a5f\u306b\u59cb\u307e\u308a\u3001ADC\u304a\u3088\u3073Multi-Hit TDC (MTDC) \u3067\u8a18\u9332\u3055\u308c\u305f\u4fe1\u53f7\u304cBuilder Bus\u3092\u901a\u3058\u3066Event Builder (EVB) \u306b\u3088\u3063\u3066\u96c6\u7d04\u3055\u308c\u30011\u30a4\u30d9\u30f3\u30c8\u5206\u306e\u30c7\u30fc\u30bf\u304c\u7d44\u307f\u7acb\u3066\u3089\u308c\u308b\u3002 \u30c8\u30ea\u30ac\u30fc\u306e\u767a\u884c\u306fDAQ Controller (DCT) \u304b\u3089\u9001\u3089\u308c\u308bDAQ gate\u306e\u5024\u304c1\u3067\u3042\u308b\u5834\u5408\u306b\u9650\u308a\u53ef\u80fd\u3067\u30010\u306b\u306a\u308b\u3068\u505c\u6b62\u3059\u308b\u3002 2025\u5e742\u6708\u6642\u70b9\u3067\u30d5\u30a1\u30fc\u30e0\u30a6\u30a7\u30a2\u306e\u30b7\u30b9\u30c6\u30e0\u30af\u30ed\u30c3\u30af\u306f75 MHz\u3067\u3042\u308b\u305f\u3081\u3001\u30c7\u30fc\u30bf\u53d6\u5f97\u6642\u306eTime Window\u306eLSB\u7cbe\u5ea6\u306f13.3 ns\u3067\u3042\u308b\u3002 \u307e\u305f\u3001TDC\u306e\u30b5\u30f3\u30d7\u30ea\u30f3\u30b0\u306b\u7528\u3044\u3089\u308c\u308b\u30af\u30ed\u30c3\u30af\u306f300 MHz\u00d74\u76f8\u306e\u5b9f\u8cea1.2 GHz\u3067\u3042\u308b\u306e\u3067\u3001\u6642\u9593\u6e2c\u5b9a\u306fLSB\u7cbe\u5ea60.833 ns\u3067\u884c\u308f\u308c\u308b\u3002</p> Figure\u00a01: RAYRAW firmware structure (toplevel.vhd)"},{"location":"firmware/overview/overview/#local-bus-modules","title":"Local Bus Modules","text":"<p>AMANEQ\u540c\u69d8\u3001RAYRAW\u30d5\u30a1\u30fc\u30e0\u30a6\u30a7\u30a2\u3067\u306fLocal Bus\u7d4c\u7531\u3067\u30a2\u30af\u30bb\u30b9\u3067\u304d\u308b\u30e2\u30b8\u30e5\u30fc\u30eb\u306e\u3053\u3068\u3092Local Bus Module\u3068\u547c\u3076\u3002 \u3053\u308c\u3089\u306e\u3046\u3061\u3001BCT\u3001FMP\u3001SDS\u3001TRM\u306b\u3064\u3044\u3066\u306fHUL User Guide\u3001C6C\u306b\u3064\u3044\u3066\u306fAMANEQ User Guide\u306b\u8aac\u660e\u304c\u3042\u308b\u306e\u3067\u3053\u3053\u3067\u306e\u8aac\u660e\u306f\u7701\u304f\u3002 \u305f\u3060\u3057\u3001TRM\u306b\u95a2\u3057\u3066\u306f\u3001HUL\u3068\u7570\u306a\u308aRM\u304a\u3088\u3073J0 bus\u304c\u5b58\u5728\u3057\u306a\u3044\u305f\u3081\u3001NIMIN\u304b\u3089\u306e\u5916\u90e8\u30c8\u30ea\u30ac\u30fc (Ext) \u306b\u95a2\u9023\u3059\u308b\u7b87\u6240\u306e\u307f\u304c\u610f\u5473\u3092\u6301\u3064\u3002 BCT\u3084FMP\u7b49\u306e\u5236\u5fa1\u306fHUL\u3068\u5171\u901a\u3067\u3042\u308b\u305f\u3081\u3001HUL\u306e\u30bd\u30d5\u30c8\u30a6\u30a7\u30a2\u306e\u57fa\u672c\u30e9\u30a4\u30d6\u30e9\u30eahul-common-lib\u306b\u3088\u308a\u884c\u308f\u308c\u308b\u4e00\u65b9\u3001YAENAMI Slow Control (YSC) \u306e\u3088\u3046\u306aRAYRAW\u56fa\u6709\u306e\u5236\u5fa1\u306fhul-common-lib+rayraw-soft\u306b\u3088\u308a\u884c\u308f\u308c\u308b (Software\u306e\u9805\u76ee\u3082\u53c2\u7167) \u3002</p> <p>Local Bus\u306f32\u30d3\u30c3\u30c8\u30a2\u30c9\u30ec\u30b9\u7a7a\u9593\u3092\u6301\u3061\u3001\u305d\u306e\u69cb\u9020\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u308b\uff1a</p> <pre><code>| module ID (4-bits) | local address (12-bits) | reserved (16-bits) |\n</code></pre> <p>Module ID\u306f\u5404Local Bus Module\u3092\u533a\u5225\u3059\u308b\u305f\u3081\u306b\u7528\u3044\u308b\u3002 Local Address\u306f\u30e2\u30b8\u30e5\u30fc\u30eb\u5185\u90e8\u306e\u30a2\u30c9\u30ec\u30b9\u5024\u3067\u3042\u308a\u3001\u30ec\u30b8\u30b9\u30bf\u3084\u52d5\u4f5c\u3092\u6307\u3059\u3002 \u524d\u8005\u306e\u5834\u5408\u3001<code>Reserved</code>\u306f\u30ec\u30b8\u30b9\u30bf\u306b\u8aad\u307f\u66f8\u304d\u3059\u308b\u30c7\u30fc\u30bf\u3092\u6307\u3059\u304c\u3001\u5f8c\u8005\u306e\u5834\u5408\u3001<code>Reserved</code>\u306f\u610f\u5473\u3092\u6301\u305f\u305a\u6307\u5b9a\u3055\u308c\u305f\u30a2\u30c9\u30ec\u30b9\u306b\u4fe1\u53f7\u3092\u9001\u308b\u3053\u3068\u81ea\u4f53\u304c\u52d5\u4f5c\u958b\u59cb\u306e\u547d\u4ee4\u3068\u306a\u308b\u3002</p> <p>\u4ee5\u4e0b\u306e\u5404\u7bc0\u3067\u306f\u3001Module ID\u306e\u30ea\u30b9\u30c8\u3092\u793a\u3057\u305f\u5f8c\u3001RAYRAW\u56fa\u6709\u306eLocal Bus Modules\u3068\u305d\u306e\u30ec\u30b8\u30b9\u30bf\u30fb\u52d5\u4f5c\u3092\u5217\u6319\u3059\u308b\u3002 \u4ee5\u4e0b\u306e\u8868\u306b\u51fa\u3066\u304f\u308b\u30ec\u30b8\u30b9\u30bf\u540d\u306f\u3001\u5b9f\u969b\u306b\u30d5\u30a1\u30fc\u30e0\u30a6\u30a7\u30a2\u306e\u30b3\u30fc\u30c9\u4e2d\u3067\u4f7f\u7528\u3055\u308c\u3066\u3044\u308b\u5909\u6570\u540d\u3067\u306f\u306a\u304f\u3001\u5b9a\u7fa9\u30d5\u30a1\u30a4\u30eb<code>def*.vhd</code>\u4e2d\u3067Local Address\u3092\u683c\u7d0d\u3059\u308b\u305f\u3081\u306b\u7528\u3044\u3089\u308c\u3066\u3044\u308b\u5b9a\u6570\uff08\u4f8b\u3048\u3070<code>kRegName</code>\uff09\u304b\u3089\u5148\u982d\u306e<code>k</code>\u3092\u9664\u3044\u305f\u3082\u306e (<code>RegName</code>) \u3067\u3042\u308b\u3002</p>"},{"location":"firmware/overview/overview/#module-id","title":"Module ID","text":"<p>Module ID\u3068Local Bus Module\u3068\u306e\u5bfe\u5fdc\u306f\u4ee5\u4e0b\u306e\u901a\u308a\u3002</p> Module ID Local Bus Module 0x0 YAENAMI Slow Control (YSC) 0x1 Trigger Manager (TRM) 0x2 DAQ Controller (DCT) 0x3 TDC 0x4 I/O Manager (IOM) 0x5 ADC 0x9 MAX1932 Controller (APD) 0xB CDCE62002 Controller (C6C) 0xC Self Diagnosis System (SDS) 0xD Flash Memory Programmer (FMP) 0xE Local Bus Controller (BCT) 0xF SiTCP\u4e88\u7d04\u9818\u57df"},{"location":"firmware/overview/overview/#yaenami-slow-control-ysc","title":"YAENAMI Slow Control (YSC)","text":"\u30ec\u30b8\u30b9\u30bf\u540d Local Address \u8aad\u307f\u66f8\u304d \u30d3\u30c3\u30c8\u9577 \u6a5f\u80fd\u30fb\u5099\u8003 WriteData 0x000 W 8 \u672a\u4f7f\u7528 (<code>Reserved</code>\u306e\u4e0a\u4f4d8\u30d3\u30c3\u30c8\u3092\u4f7f\u7528\u3057\u5e38\u306b\u66f4\u65b0\u3055\u308c\u308b) BusyFlag 0x200 R 1 SPI\u901a\u4fe1\u306e\u30d3\u30b8\u30fc\u4fe1\u53f7 StartCycle 0x300 W 1 SPI\u901a\u4fe1\u306e\u9001\u4fe1\u30b5\u30a4\u30af\u30eb (FPGA\u2192YAENAMI) \u3092\u958b\u59cb\u3059\u308b ChipSelect 0x400 W 4 4\u3064\u306eASIC\u306e\u3069\u308c\u306b\u30c7\u30fc\u30bf\u3092\u9001\u308b\u304b\u3092\u9078\u629e\u3059\u308b (\u8907\u6570\u53ef)"},{"location":"firmware/overview/overview/#daq-controller-dct","title":"DAQ Controller (DCT)","text":"\u30ec\u30b8\u30b9\u30bf\u540d Local Address \u8aad\u307f\u66f8\u304d \u30d3\u30c3\u30c8\u9577 \u6a5f\u80fd\u30fb\u5099\u8003 DaqGate 0x000 W/R 1 DAQ gate\u306eON/OFF (TRM\u306e\u30c8\u30ea\u30ac\u30fc\u51fa\u529b\u306e\u6709\u52b9\u5316/\u7121\u52b9\u5316) ResetEvb 0x010 W 1 EVB\u5185\u306eEventBuffer (FIFO) \u306e\u30ea\u30bb\u30c3\u30c8\u4fe1\u53f7 <p>DaqGate\u306f\u30de\u30cb\u30e5\u30a2\u30eb\u3067\u6709\u52b9\u5316/\u7121\u52b9\u5316\u3059\u308b\u3053\u3068\u3082\u3067\u304d\u308b\u304c\u3001rayraw-soft\u3092\u7528\u3044\u3066\u53d6\u5f97\u3057\u305f\u3044\u30a4\u30d9\u30f3\u30c8\u6570\u3092\u6307\u5b9a\u3057\u3001\u30bd\u30d5\u30c8\u30a6\u30a7\u30a2\u306b\u3088\u3063\u3066\u81ea\u52d5\u7684\u306b\u6709\u52b9\u5316/\u7121\u52b9\u5316\u3059\u308b\u3053\u3068\u3092\u63a8\u5968\u3059\u308b (Software\u306e\u9805\u76ee\u3082\u53c2\u7167)\u3002</p>"},{"location":"firmware/overview/overview/#tdc","title":"TDC","text":"\u30ec\u30b8\u30b9\u30bf\u540d Local Address \u8aad\u307f\u66f8\u304d \u30d3\u30c3\u30c8\u9577 \u6a5f\u80fd\u30fb\u5099\u8003 EnBlock 0x000 W/R 2 TDCBlock (Leading/Trailing) \u3092\u6709\u52b9\u5316\u3059\u308b OfsPtr 0x010 W/R 11 \u30ea\u30f3\u30b0\u30d0\u30c3\u30d5\u30a1\u306e\u8aad\u307f\u51fa\u3057\u30dd\u30a4\u30f3\u30bf\u306e\u30aa\u30d5\u30bb\u30c3\u30c8 WinMax 0x020 W/R 11 Time Window\u306e\u6700\u5927\u5024 WinMin 0x030 W/R 11 Time Window\u306e\u6700\u5c0f\u5024"},{"location":"firmware/overview/overview/#io-manager-iom","title":"I/O Manager (IOM)","text":"<p>FPGA\u5185\u90e8\u306e\u4fe1\u53f7\u7dda\u3092NIMOUT\u3078\u5272\u308a\u5f53\u3066\u305f\u308a\u3001NIMIN\u306e\u4fe1\u53f7\u3092FPGA\u5185\u90e8\u306e\u4fe1\u53f7\u7dda\u306b\u63a5\u7d9a\u3057\u305f\u308a\u3059\u308b\u6a5f\u80fd\u3092\u6301\u3064\u3002 HUL\u306e\u3082\u306e\u3092\u6d41\u7528\u3057\u3066\u3044\u308b\u304c\u3001\u5165\u51fa\u529b\u30dd\u30fc\u30c8\u306e\u6570\u304cHUL\u3068\u7570\u306a\u308b\u305f\u3081\u82e5\u5e72\u306e\u9055\u3044\u304c\u5b58\u5728\u3059\u308b\u3002</p> \u30ec\u30b8\u30b9\u30bf\u540d Local Address \u8aad\u307f\u66f8\u304d \u30d3\u30c3\u30c8\u9577 \u6a5f\u80fd\u30fb\u5099\u8003 NimOut1 0x000 W/R 4 NIMOUT1\u3078\u5272\u308a\u5f53\u3066\u308b\u5185\u90e8\u4fe1\u53f7\u7dda\u306e\u9078\u629e NimOut2 0x010 W/R 4 NIMOUT2\u3078\u5272\u308a\u5f53\u3066\u308b\u5185\u90e8\u4fe1\u53f7\u7dda\u306e\u9078\u629e ExtL1 0x040 W/R 3 \u5185\u90e8\u4fe1\u53f7\u7ddaextL1\u3078\u5272\u308a\u5f53\u3066\u308b\u5165\u529b\u30dd\u30fc\u30c8\u306e\u9078\u629e ExtL2 0x050 W/R 3 \u5185\u90e8\u4fe1\u53f7\u7ddaextL2\u3078\u5272\u308a\u5f53\u3066\u308b\u5165\u529b\u30dd\u30fc\u30c8\u306e\u9078\u629e ExtClr 0x060 W/R 3 \u5185\u90e8\u4fe1\u53f7\u7ddaextClr\u3078\u5272\u308a\u5f53\u3066\u308b\u5165\u529b\u30dd\u30fc\u30c8\u306e\u9078\u629e ExtBusy 0x070 W/R 3 \u5185\u90e8\u4fe1\u53f7\u7ddaextBusy\u3078\u5272\u308a\u5f53\u3066\u308b\u5165\u529b\u30dd\u30fc\u30c8\u306e\u9078\u629e <p>\u4e0a\u8a18<code>NimOut1/2</code>\u306e\u5024\u306b\u5fdc\u3058\u3066\u4ee5\u4e0b\u306e\u4fe1\u53f7\u7dda\u304cNIMOUT1/2\u306b\u5272\u308a\u5f53\u3066\u3089\u308c\u308b\u3002</p> NimOut1/2\u306e\u5024 \u5185\u90e8\u4fe1\u53f7\u7dda \u5099\u8003 0x0 moduleBusy TRM\u304c\u767a\u884c\u3059\u308bModule busy\u3092\u51fa\u529b 0x1 daqGate DAQ gate\u3092\u51fa\u529b 0x2 clk1MHz 1 MHz\u306e\u30af\u30ed\u30c3\u30af\u3092\u51fa\u529b 0x3 clk100kHz 100 kHz\u306e\u30af\u30ed\u30c3\u30af\u3092\u51fa\u529b 0x4 clk10kHz 10 kHz\u306e\u30af\u30ed\u30c3\u30af\u3092\u51fa\u529b 0x5 clk1kHz 1 kHz\u306e\u30af\u30ed\u30c3\u30af\u3092\u51fa\u529b 0xE 0 Low\u3092\u51fa\u529b <p>\u307e\u305f\u3001<code>ExtL1, ExtL2, ExtClr, ExtBusy</code> (\u8868\u4e2d<code>Ext*</code>\u3068\u3059\u308b) \u306e\u5024\u306b\u5fdc\u3058\u3066\u4ee5\u4e0b\u306e\u5165\u529b\u30dd\u30fc\u30c8\u304c\u5bfe\u5fdc\u3059\u308b\u5185\u90e8\u4fe1\u53f7\u7dda\u306b\u5272\u308a\u5f53\u3066\u3089\u308c\u308b\u3002 \u305f\u3060\u3057ExtBusy\u306f\u3069\u3053\u306b\u3082\u7e4b\u304c\u3063\u3066\u3044\u306a\u3044\u305f\u3081\u3001\u5916\u304b\u3089Veto\u4fe1\u53f7\u3092\u5165\u529b\u3057\u305f\u3068\u3057\u3066\u3082RAYRAW\u3067\u306fTrigger\u3092\u6b62\u3081\u308b\u3053\u3068\u306f\u3067\u304d\u306a\u3044\u3002\u305d\u306e\u305f\u3081\u3001RAYRAW\u306b\u5165\u529b\u3059\u308bNIM\u4fe1\u53f7\u81ea\u4f53\u306bVeto\u3092\u304b\u3051\u306a\u3051\u308c\u3070\u306a\u3089\u306a\u3044\u3002</p> Ext*\u306e\u5024 NIM\u5165\u529b\u30dd\u30fc\u30c8 0x0 NIMIN1 0x1 NIMIN2 0x6 0 <p>IOM\u5185\u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u5165\u51fa\u529b\u306e\u5272\u308a\u5f53\u3066\u306f\u6b21\u306e\u901a\u308a\u3067\u3042\u308b\u3002 \u305f\u3060\u3057\u30012025\u5e742\u6708\u6642\u70b9\u3067\u306fIOM\u306fNIMOUT\u3068\u63a5\u7d9a\u3055\u308c\u3066\u304a\u3089\u305a\u3001\u304b\u308f\u308a\u306b<code>toplevel.vhd</code>\u5185\u3067NIMOUT1\u3068NIMOUT2\u306b\u305d\u308c\u305e\u308c\u30b7\u30b9\u30c6\u30e0\u30af\u30ed\u30c3\u30af\u3068Module busy\u304c\u5272\u308a\u5f53\u3066\u3089\u308c\u3066\u3044\u308b\u3002</p> NIM\u51fa\u529b\u30dd\u30fc\u30c8 \u30c7\u30d5\u30a9\u30eb\u30c8\u5185\u90e8\u4fe1\u53f7\u7dda NIMOUT1 moduleBusy NIMOUT2 clk1kHz \u5185\u90e8\u4fe1\u53f7\u7dda \u30c7\u30d5\u30a9\u30eb\u30c8NIM\u5165\u529b\u30dd\u30fc\u30c8 extL1 NIMIN1 extL2 0 extClr 0 extBusy NIMIN2"},{"location":"firmware/overview/overview/#adc","title":"ADC","text":"\u30ec\u30b8\u30b9\u30bf\u540d Local Address \u8aad\u307f\u66f8\u304d \u30d3\u30c3\u30c8\u9577 \u6a5f\u80fd\u30fb\u5099\u8003 OfsPtr 0x000 W/R 11 \u30ea\u30f3\u30b0\u30d0\u30c3\u30d5\u30a1\u306e\u8aad\u307f\u51fa\u3057\u4f4d\u7f6e\u3092\u793a\u3059\u30dd\u30a4\u30f3\u30bf WinMax 0x010 W/R 11 Time Window\u306e\u6700\u5927\u5024 WinMin 0x020 W/R 11 Time Window\u306e\u6700\u5c0f\u5024 AdcRoReset 0x030 W/R 1 ADC\u8aad\u307f\u51fa\u3057\u90e8 (FIFO\u7b49) \u306e\u30ea\u30bb\u30c3\u30c8\u4fe1\u53f7 (\u30c7\u30d5\u30a9\u30eb\u30c8\u306f1) IsReady 0x040 R 4 \u5404ASIC\u304b\u3089\u306eADC\u8aad\u307f\u51fa\u3057\u6e96\u5099\u72b6\u6cc1 <p><code>AdcRoReset</code>\u306b\u3064\u3044\u3066\u5c11\u3057\u88dc\u8db3\u3092\u3057\u3066\u304a\u304f\u3002 \u3053\u306eready\u4fe1\u53f7\u306f<code>YaenamiAdc.vhd</code>\u5185\u3067\u5024\u306e\u8a2d\u5b9a\u304c\u884c\u308f\u308c\u3066\u304a\u308a\u3001IDELAY\u306b\u3088\u308a\u9069\u5207\u306a\u9045\u5ef6\u304c\u304b\u304b\u308aISERDES\u306ebitslip\u304c\u9069\u5207\u306a\u5024\u306b\u306a\u3063\u305f\u30bf\u30a4\u30df\u30f3\u30b0\u30671\u3068\u306a\u308b (TRG-ADC-TDC\u306eADC\u306e\u9805\u76ee\u53c2\u7167) \u3002</p>"},{"location":"firmware/overview/overview/#max1932-controller-apd","title":"MAX1932 Controller (APD)","text":"\u30ec\u30b8\u30b9\u30bf\u540d Local Address \u8aad\u307f\u66f8\u304d \u30d3\u30c3\u30c8\u9577 \u6a5f\u80fd\u30fb\u5099\u8003 Txd 0x000 W 8 MAX1932\u3078\u306e8\u30d3\u30c3\u30c8DAC\u5165\u529b ExecWrite 0x100 W - SPI\u901a\u4fe1(\u9001\u4fe1)\u3092\u958b\u59cb\u3059\u308b"},{"location":"firmware/overview/overview/#data-structure","title":"Data structure","text":"<p>EVB\u306b\u3088\u308a\u751f\u6210\u3055\u308c\u308b1\u30a4\u30d9\u30f3\u30c8\u306e\u30c7\u30fc\u30bf\u69cb\u9020\u306f\u4ee5\u4e0b\u306e\u901a\u308a\u3067\u3042\u308b (\u30c7\u30fc\u30bf\u306f\u5168\u306632\u30d3\u30c3\u30c8\u9577) \u3002</p> <pre><code>Header 1: | 0xFFFF0160 |\nHeader 2: | 0xFF0 | 0 | overflow (1-bit) | event size (18-bits) |\nHeader 3: | 0xFF | 0 (enRM) | 000 | 0000 (trigger tag) | event number (16-bits) |\nTDCL   1: | 0xCC | 0 | TDC ch (7-bits) | 0 | TDC data (15-bits) |\n                                   ...\nTDCL  n1: | 0xCC | 0 | TDC ch (7-bits) | 0 | TDC data (15-bits) |\nTDCT   1: | 0xCD | 0 | TDC ch (7-bits) | 0 | TDC data (15-bits) |\n                                   ...\nTDCT  n2: | 0xCD | 0 | TDC ch (7-bits) | 0 | TDC data (15-bits) |\nADC    1: | 0xA | ADC ch (5-bits) | 00 | coarse TDC (11-bits) | ADC (10-bits) |\n                                   ...\nADC   n3: | 0xA | ADC ch (5-bits) | 00 | coarse TDC (11-bits) | ADC (10-bits) |\n</code></pre> <p>\u307e\u305a\u3001\u30a4\u30d9\u30f3\u30c8\u306e\u533a\u5207\u308a\u3092\u8868\u3059Header 1\u304c\u9001\u3089\u308c\u308b\u3002 \u6b21\u306b\u3001\u30a4\u30d9\u30f3\u30c8\u306b\u542b\u307e\u308c\u308bTDCL (TDC Leading)\u3001TDCT (TDC Trailing)\u3001ADC\u304b\u3089\u306e\u30ef\u30fc\u30c9\u6570\u306e\u5408\u8a08<code>n1+n2+n3</code>\u3092\u30a4\u30d9\u30f3\u30c8\u30b5\u30a4\u30ba\u3068\u3057\u3066Header 2\u304c\u9001\u3089\u308c\u308b\u3002 Header 2\u5185\u306e<code>overflow</code>\u306f1\u30a4\u30d9\u30f3\u30c8\u4e2d\u306bTDC\u3067\u30ab\u30a6\u30f3\u30c8\u3067\u304d\u308b\u6700\u5927\u306e\u30d2\u30c3\u30c8\u6570\u3092\u8d85\u3048\u305f\u5834\u5408\u306b1\u3068\u306a\u308b\u30d5\u30e9\u30b0\u3067\u3042\u308b\u3002 \u7d9a\u3044\u3066\u73fe\u5728\u306e\u30a4\u30d9\u30f3\u30c8\u756a\u53f7\u304cHeader 3\u3068\u3057\u3066\u9001\u3089\u308c\u305f\u5f8c\u3001TDCL\u3001TDCT\u3001ADC\u304b\u3089\u306e\u30c7\u30fc\u30bf\u304c\u3053\u306e\u9806\u306b\u9001\u3089\u308c\u308b\u3002 15\u30d3\u30c3\u30c8TDC\u30c7\u30fc\u30bf\u306e\u4e0a\u4f4d11\u30d3\u30c3\u30c8\u306f\u30b7\u30b9\u30c6\u30e0\u30af\u30ed\u30c3\u30af\u5358\u4f4d\u3067\u6e2c\u3089\u308c\u308b\u7c97\u3044\u6642\u9593\u60c5\u5831 (coarse TDC) \u3067\u3042\u308a\u3001ADC\u306f\u3053\u306ecoarse TDC\u3092\u901a\u3058\u3066\u3088\u308a\u7d30\u3044\u6642\u9593\u5206\u89e3\u80fd\u3092\u6301\u3064TDC\u30c7\u30fc\u30bf\u3068\u7d10\u4ed8\u3051\u3089\u308c\u308b\u3002</p> <p>\u306a\u304a\u3001\u4e0a\u306e\u30d6\u30ed\u30c3\u30af\u4e2d\u306e<code>enRM</code>\u304a\u3088\u3073<code>trigger tag</code>\u306f\u3001HUL\u306b\u304a\u3044\u3066Ext/J0/RM\u306e\u3069\u306e\u30c8\u30ea\u30ac\u30fc\u3067\u30c7\u30fc\u30bf\u53d6\u5f97\u3092\u3057\u305f\u304b\u3092\u8b58\u5225\u3059\u308b\u305f\u3081\u306b\u7528\u3044\u3089\u308c\u3066\u3044\u305f\u304c\u3001RAYRAW\u306b\u304a\u3044\u3066\u306f\u5e38\u306b\u50240\u3068\u306a\u308b\u3002</p>"},{"location":"firmware/overview/overview/#rayrawled","title":"RAYRAW\u4e0a\u306e\u30b9\u30a4\u30c3\u30c1\u30fbLED\u306e\u6a5f\u80fd","text":""},{"location":"firmware/overview/overview/#sw1","title":"SW1\u306e\u6a5f\u80fd","text":"\u30b9\u30a4\u30c3\u30c1\u756a\u53f7 \u6a5f\u80fd \u8a73\u7d30 1 not used 2 SiTCP force default OFF\u3067SiTCP\u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u30e2\u30fc\u30c9\u3067\u8d77\u52d5\u3057\u307e\u3059\u3002\u96fb\u6e90\u6295\u5165\u524d\u306b\u8a2d\u5b9a\u3057\u3066\u3044\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002 3 C6C reset Jitter Cleaner (CDCE62002)\u306eHardware Reset\u3067\u3059\u3002 4 not used 5 not used 6 not used 7 not used 8 not used"},{"location":"firmware/overview/overview/#sw2","title":"SW2","text":"<p>\u5168\u3066\u306e\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u30ea\u30bb\u30c3\u30c8\u3059\u308b\u305f\u3081\u306eHardware Reset\u3002</p>"},{"location":"firmware/overview/overview/#led","title":"LED","text":"\u756a\u53f7 \u5099\u8003 1 \u70b9\u706f\u4e2d\u306fTCP\u63a5\u7d9a\u304c\u5f35\u3089\u308c\u3066\u3044\u307e\u3059\u3002 2 RAYRAW\u304cBUSY\u4fe1\u53f7\u3092\u51fa\u3057\u3066\u3044\u307e\u3059\u3002 3 TDC\u3084ADC\u306b\u7528\u3044\u308bCoarse\u3001Fine Clock\u3092\u4f5c\u308bMMCM\u304c\u30ed\u30c3\u30af\u3057\u3066\u3044\u307e\u3059\u3002 4 Jitter Cleaner (CDCE62002)\u304c\u30ed\u30c3\u30af\u3057\u3066\u3044\u307e\u3059\u3002"},{"location":"firmware/trg-adc-tdc/trg-adc-tdc/","title":"Triggered-type ADC Multi-Hit TDC","text":""},{"location":"firmware/trg-adc-tdc/trg-adc-tdc/#multi-hit-tdc-mtdc","title":"Multi-Hit TDC (MTDC)","text":""},{"location":"firmware/trg-adc-tdc/trg-adc-tdc/#outline","title":"Outline","text":"<p>RAYRAW\u306b\u5b9f\u88c5\u3055\u308c\u3066\u3044\u308bTDC\u30d5\u30a1\u30fc\u30e0\u30a6\u30a7\u30a2\u306f\u3001Common Stop\u304c\u767a\u884c\u3055\u308c\u305f\u30bf\u30a4\u30df\u30f3\u30b0\u304b\u3089Time Window\u5206\u3060\u3051\u3055\u304b\u306e\u307c\u3063\u305f\u6642\u9593\u5185\u306b\u3042\u308b\u30d2\u30c3\u30c8\u306e\u7acb\u3061\u4e0a\u304c\u308a\u30fb\u7acb\u3061\u4e0b\u304c\u308a\u6642\u523b\u3092 1 LSB = 0.833 ns \u306e\u6642\u9593\u5206\u89e3\u80fd\u3067\u305d\u308c\u305e\u308c\uff0832ch\u305d\u308c\u305e\u308c\u3067\uff09\u6700\u592716\u500b\u8a18\u9332\u3059\u308b\u3001Multi-Hit TDC\u3067\u3042\u308b\uff08\u4e0b\u56f3\u53c2\u7167\uff09\u3002</p> Figure\u00a01: Concept of MTDC <p>MTDC\u30d6\u30ed\u30c3\u30af\u306e\u69cb\u9020\u306f\u4e0b\u56f3\u306b\u793a\u3059\u901a\u308a\u3067\u3042\u308b\u3002</p> Figure\u00a02: RAYRAW Multi-Hit TDC (MTDC.vhd) <p>\u5404\u3005\u306e\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u306f\u4ee5\u4e0b\u306e\u50cd\u304d\u3092\u6301\u3064:</p> <ul> <li>CommonStop: TRM\u304b\u3089\u306eL1accept\u5165\u529b\u306e\u6642\u523b\u30920.833 ns\u306e\u6642\u9593\u5206\u89e3\u80fd\u3067\u6e2c\u5b9a\u3057\u30015\u30d3\u30c3\u30c8\u306ecstop\u3092\u51fa\u529b\u3059\u308b\u3002cstop\u306eMSB\u306fL1accept\u306e\u6709\u7121\u3092\u3001\u4e0b\u4f4d4\u30d3\u30c3\u30c8\u306f 0.833 ns \u306e\u7d30\u304b\u3044\u5206\u89e3\u80fd\u3092\u6301\u3064\u6642\u9593\u60c5\u5831\u3092\u793a\u3059\u3002</li> <li>TDCBlock (Leading): YAENAMI\u304b\u3089\u306e32ch Discri\u5165\u529b\u306e\u7acb\u3061\u4e0a\u304c\u308a\u6642\u523b\u3092 0.833 ns \u306e\u7d30\u304b\u3044\u5206\u89e3\u80fd\u3067\u4fdd\u6301\u3057\u3001cstop\u304c\u5165\u529b\u3055\u308c\u305f\u30bf\u30a4\u30df\u30f3\u30b0\u3067\u7c97\u3044\u6642\u9593\u60c5\u5831\u3068\u7d44\u307f\u5408\u308f\u305b\u3066EVB\u3078\u3068\u30c7\u30fc\u30bf\u3092\u9001\u4fe1\u3059\u308b\u3002\u307e\u305f\u3001\u51e6\u7406\u306e\u9014\u4e2d\u306b\u306fbusy\u4fe1\u53f7\u3092TRM\u3078\u3068\u9001\u308b\u3002</li> <li>TDCBlock (Trailing): Discri\u5165\u529b\u306e\u7acb\u3061\u4e0b\u304c\u308a\u6642\u523b\u3092\u8a18\u9332\u3059\u308b\u3002TDCBlock (Leading)\u3068\u540c\u4e00\u306e\u69cb\u9020\u3092\u6301\u3064\u304c\u3001\u5165\u529b\u4fe1\u53f7\u3092\u53cd\u8ee2\u3055\u305b\u308b\u3053\u3068\u3067\u3001\u7acb\u3061\u4e0b\u304c\u308a\u6642\u523b\u306e\u6e2c\u5b9a\u3092\u884c\u3063\u3066\u3044\u308b\u3002</li> </ul>"},{"location":"firmware/trg-adc-tdc/trg-adc-tdc/#fine-tdc-measurement-multi-phase-tdc","title":"Fine TDC measurement (Multi-phase TDC)","text":"<p>0.833 ns\u3067\u7d30\u304b\u3044\u6642\u9593\u60c5\u5831\u3092\u8a18\u9332\u3059\u308b\u90e8\u5206\u306fCommonStop\u3068TDCBlock\u3068\u3067\u5171\u901a\u3067\u3042\u308a\u3001\u56f3\u3067\u306fFineCount Part\u3068\u3057\u305f\u3002 \u3053\u306eFineCount Part\u306e\u5b9f\u88c5\u3092\u4e0b\u56f3\u306b\u793a\u3059\u3002</p> Figure\u00a03: FineCount Part <p>\u5404\u3005\u306e\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u306f\u4ee5\u4e0b\u306e\u50cd\u304d\u3092\u6301\u3064:</p> <ul> <li>FirstFDCEs: Discri\u5165\u529b\u30924\u3064\u306e\u7570\u306a\u308b\u4f4d\u76f8 (0\u00b0,90\u00b0,180\u00b0, 270\u00b0) \u3092\u6301\u3064300 MHz\u306e\u30af\u30ed\u30c3\u30af (4\u76f8\u30af\u30ed\u30c3\u30af) \u3067\u30e9\u30c3\u30c1\u3059\u308b\u3002\u3053\u308c\u306f\u5f8c\u6bb5\u3067\u306e\u30e1\u30bf\u30b9\u30c6\u30fc\u30d6\u30eb\u72b6\u614b\u3092\u56de\u907f\u3059\u308b\u305f\u3081\u306e\u63aa\u7f6e\u3067\u3042\u308b\u3002</li> <li>FineCounter: \u524d\u6bb5\u306e4\u3064\u306e\u51fa\u529b\u3092\u5404\u3005\u5bfe\u5fdc\u3059\u308b4\u76f8\u30af\u30ed\u30c3\u30af\u3067\u518d\u5ea6\u30e9\u30c3\u30c1\u3057\u305f\u5f8c\u3001\u30af\u30ed\u30c3\u30af\u30c9\u30e1\u30a4\u30f3\u3092\u7d71\u4e00\u3059\u308b\u305f\u3081\u4f4d\u76f80\u00b0\u30674\u3064\u306e\u5165\u529b\u3092\u30e9\u30c3\u30c1\u3059\u308b\u3002\u4f4d\u76f80\u00b0\u3068\u4f4d\u76f8270\u00b0\u306e\u30af\u30ed\u30c3\u30af\u306f\u7acb\u3061\u4e0a\u304c\u308a\u6642\u523b\u306e\u5dee\u304c0.833 ns\u3057\u304b\u306a\u304fFPGA\u306e\u914d\u7dda\u9045\u5ef6\u306e\u5f71\u97ff\u3092\u53d7\u3051\u308b\u305f\u3081\u3001\u6700\u521d\u4f4d\u76f8270\u00b0\u306e\u30af\u30ed\u30c3\u30af\u3067\u30e9\u30c3\u30c1\u3057\u305f\u30c7\u30fc\u30bf\u306f\u4ed6\u306e\u4f4d\u76f8\u306e\u30af\u30ed\u30c3\u30af\u3067\u30e9\u30c3\u30c1\u3057\u305f\u30c7\u30fc\u30bf\u3068\u6bd4\u3079\u30661\u30af\u30ed\u30c3\u30af\u9045\u308c\u3066\u5f8c\u6bb5\u306b\u5c4a\u304f\u3002\u305d\u3053\u3067\u3001\u3053\u308c\u3089\u306e\u30e9\u30c3\u30c1\u3055\u308c\u305f\u30c7\u30fc\u30bf\u306e\u3046\u3061\u3001\u521d\u6bb5\u306b\u304a\u3044\u3066\u4f4d\u76f80\u00b0,90\u00b0,180\u00b0\u306e\u30af\u30ed\u30c3\u30af\u3067\u30e9\u30c3\u30c1\u3055\u308c\u3066\u3044\u305f\u30c7\u30fc\u30bf\u30921\u30af\u30ed\u30c3\u30af\u3060\u3051\u9045\u3089\u305b\u308b\u3002</li> <li>FineCounterDecoder: \u524d\u6bb5\u306b\u3066\u3001\u30b7\u30b9\u30c6\u30e0\u30af\u30ed\u30c3\u30af1\u5468\u671f\u306b\u3064\u304d4-bits\u306e\u30c7\u30fc\u30bf\u304c300 MHz\u306e\u30af\u30ed\u30c3\u30af\u30c9\u30e1\u30a4\u30f3\u3067\u5f97\u3089\u308c\u305f\u304c\u3001\u6b21\u306f\u3053\u308c\u3092\u30b7\u30b9\u30c6\u30e0\u30af\u30ed\u30c3\u30af\u306b\u540c\u671f\u3055\u305b\u308b\u5fc5\u8981\u304c\u3042\u308b\u3002TDC\u7528\u30af\u30ed\u30c3\u30af(300 MHz)/\u30b7\u30b9\u30c6\u30e0\u30af\u30ed\u30c3\u30af(75 MHz)=4\u6bb5\u306e\u30d5\u30ea\u30c3\u30d7\u30d5\u30ed\u30c3\u30d7\u304c\u3042\u308c\u3070\u3001TDC\u30af\u30ed\u30c3\u30af4\u5468\u671f\u306e\u9593\u306b4\u6bb5\u00d74\u30d3\u30c3\u30c8=16\u30d3\u30c3\u30c8\u306e\u30c7\u30fc\u30bf\u3092\u4fdd\u6301\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u3002\u3053\u308c\u3092\u30b7\u30b9\u30c6\u30e0\u30af\u30ed\u30c3\u30af\u306e\u7acb\u3061\u4e0a\u304c\u308a\u306e\u30bf\u30a4\u30df\u30f3\u30b0\u3067\u30e9\u30c3\u30c1\u3059\u308b\u3053\u3068\u306b\u3088\u308a\u3001\u30af\u30ed\u30c3\u30af\u30c9\u30e1\u30a4\u30f3\u3092\u30b7\u30b9\u30c6\u30e0\u30af\u30ed\u30c3\u30af\u306b\u79fb\u3059\u3053\u3068\u304c\u3067\u304d\u308b\u3002\u51fa\u529b\u306efine count\u306f4\u30d3\u30c3\u30c8\u3067\u3001\u4e0a\u4f4d2\u30d3\u30c3\u30c8\u304csemi-fine count (4\u6bb5\u306e\u3069\u3053\u306b\u30d2\u30c3\u30c8\u304c\u3042\u3063\u305f\u304b)\u3001\u4e0b\u4f4d2\u30d3\u30c3\u30c8\u304cfine count (4\u3064\u306e\u30af\u30ed\u30c3\u30af\u306e\u3069\u3053\u306b\u30d2\u30c3\u30c8\u304c\u3042\u3063\u305f\u304b)\u3068\u3044\u3046\u60c5\u5831\u3092\u6301\u3063\u3066\u3044\u308b (\u4e0b\u56f3\u53c2\u7167)\u3002</li> </ul> <p>\u51fa\u529bhit_found\u304a\u3088\u3073fine_count[3:0]\u306f\u305d\u308c\u305e\u308c1\u30b7\u30b9\u30c6\u30e0\u30af\u30ed\u30c3\u30af\u5185\u3067\u306e\u4fe1\u53f7\u306e\u7acb\u3061\u4e0a\u304c\u308a\u306e\u6709\u7121\u3068\u3001\u305d\u306e\u969b\u306e0.833 ns\u306e\u7cbe\u5ea6\u3067\u306e\u6642\u9593\u60c5\u5831\u3092\u8868\u3059\u3002</p> Figure\u00a04: How FineCount Part works"},{"location":"firmware/trg-adc-tdc/trg-adc-tdc/#event-building","title":"Event building","text":"<p>TDCBlock\u306fCommonStop\u304b\u3089\u306e\u5165\u529b\u6642\u306b1\u30a4\u30d9\u30f3\u30c8\u306e\u30c7\u30fc\u30bf\u3092Builder Bus\u3078\u3068\u9001\u308b\u3002 \u3053\u306eEventBuild Part\u306e\u30d6\u30ed\u30c3\u30af\u56f3\u3092\u4e0b\u306b\u793a\u3059\u3002 \u56f3\u4e2d\u306e\u56db\u89d2\u3067\u56f2\u307e\u308c\u305f\u6587\u5b57\u306f\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u3092\u3001\u89d2\u4e38\u56db\u89d2\u3067\u56f2\u307e\u308c\u305f\u6587\u5b57\u306f\u4e00\u9023\u306e\u51e6\u7406 (\u3042\u308b\u3044\u306f\u30b9\u30c6\u30fc\u30c8\u30de\u30b7\u30f3) \u3092\u793a\u3059\u3002</p> Figure\u00a05: EventBuild Part <p>TDCBlock\u5185\u306eFineCount Part\u3067\u6e2c\u5b9a\u3055\u308c\u305f1\u30d3\u30c3\u30c8\u306ehit_found\u30684\u30d3\u30c3\u30c8\u306efine_count\u306f\u3001\u30b7\u30b9\u30c6\u30e0\u30af\u30ed\u30c3\u30af\u306b\u540c\u671f\u3057\u306632ch\u307e\u3068\u3081\u3066\u30d3\u30c3\u30c8\u9577160\u3001\u6df1\u30554096\u306e\u30ea\u30f3\u30b0\u30d0\u30c3\u30d5\u30a1\u306b\u8a70\u3081\u3089\u308c\u308b\u3002 cstop\u5165\u529b\u304c\u3042\u308b\u3068\u3001RingBuffer to ChannelBuffer Write Process\u304ccstop\u5165\u529b\u30bf\u30a4\u30df\u30f3\u30b0\u304b\u3089TimeWindow\u5206\u3060\u3051\u30ea\u30f3\u30b0\u30d0\u30c3\u30d5\u30a1\u3092\u8d70\u67fb\u3057\u3001hit_found\u304c1\u306e\u5834\u5408\u307e\u305f\u306f\u30ea\u30f3\u30b0\u30d0\u30c3\u30d5\u30a1\u306e\u8d70\u67fb\u7d42\u4e86\u6642\u306b\u4ee5\u4e0b\u3067\u8a08\u7b97\u3055\u308c\u308bTDC</p> <pre><code>TDC = (coarse_counter[10:0] &amp; std_logic_vector(to_unsigned(0, 4))) - fine_count[3:0] + cstop[3:0]\n</code></pre> <p>\u3092\u5bfe\u5fdc\u3059\u308b\u30c1\u30e3\u30f3\u30cd\u30eb\u306eChannelBuffer\u306b\u66f8\u304d\u8fbc\u3080\u3002 \u3053\u308c\u306f\u4e0a\u4f4d11\u30d3\u30c3\u30c8\u304c75 MHz\u30af\u30ed\u30c3\u30af\u3067\u6e2c\u3089\u308c\u305f\u7c97\u3044\u6642\u9593\u60c5\u5831\u3092\u3001\u4e0b\u4f4d4\u30d3\u30c3\u30c8\u304c\u4f4d\u76f8\u304c90\u00b0\u305a\u3064\u7570\u306a\u308b300 MHz\u30af\u30ed\u30c3\u30af\u3067\u6e2c\u3089\u308c\u305f\u7d30\u304b\u3044\u6642\u9593\u60c5\u5831\u3092\u6301\u3064\u8a0815\u30d3\u30c3\u30c8\u306e\u30c7\u30fc\u30bf\u3067\u3042\u308b\u3002 \u5b9f\u969b\u306b\u306f15\u30d3\u30c3\u30c8\u306eTDC\u306b\u52a0\u3048\u3001\u6700\u4e0a\u4f4d\u30d3\u30c3\u30c8\u306bdata_bit\u3092\u4ed8\u4e0e\u3059\u308b\u3002 \u3053\u306edata_bit\u306b\u306f\u30c7\u30fc\u30bf\u8aad\u307f\u51fa\u3057\u6642\u306b\u306f\u50241(\u30c7\u30fc\u30bf)\u3001\u30ea\u30f3\u30b0\u30d0\u30c3\u30d5\u30a1\u306e\u8d70\u67fb\u7d42\u4e86\u6642\u306b\u306f\u50240(\u30a4\u30d9\u30f3\u30c8\u533a\u5207\u308a)\u304c\u8a70\u3081\u3089\u308c\u308b\u3002 ChannelBuffer\u5185\u306eTDC\u306f\u3001\u5f8c\u6bb5\u306eFIFO\u3084\u30c7\u30fc\u30bf\u8ee2\u9001\u306b\u6ede\u308a\u306e\u306a\u3044\u9650\u308a\u9806\u6b21Build Process\u306b\u3088\u308a</p> <pre><code>magic word (8-bits) &amp; '0' &amp; tdc_ch (7-bits) &amp; '0' &amp; TDC (15-bits)\n</code></pre> <p>\u306e\u3088\u3046\u306bmagic word\u3068\u30c1\u30e3\u30f3\u30cd\u30eb\u60c5\u5831\u3092\u4ed8\u4e0e\u3055\u308c\u305f32\u30d3\u30c3\u30c8\u30ef\u30fc\u30c9\u304c\u4f5c\u3089\u308c\u3001ch0\u304b\u3089ch31\u307e\u3067\u9806\u6b21data_bit\u304c1\u306e\u5834\u5408\u306bBlockBuffer\u3078\u3068\u66f8\u304d\u8fbc\u307e\u308c\u308b\u3002 \u3053\u3053\u3067\u3001magic word\u3068\u306f\u30c7\u30fc\u30bf\u306e\u5185\u5bb9\u3092\u793a\u3059\u8b58\u5225\u5b50\u3067\u3042\u308a\u3001TDC(Leading)\u306e\u5834\u5408\u306f<code>X\"cc\"</code>\u3001TDC(Trailing)\u306e\u5834\u5408\u306f<code>X\"cd\"</code>\u306b\u305d\u308c\u305e\u308c\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u308b\u3002 \u66f8\u304d\u8fbc\u307f\u304c\u884c\u308f\u308c\u308b\u305f\u3073\u306b\u3001Build Process\u306f\u305d\u306e\u30a4\u30d9\u30f3\u30c8\u5185\u306e\u30ef\u30fc\u30c9\u6570\u3092\u30ab\u30a6\u30f3\u30c8\u30a2\u30c3\u30d7\u3057\u3001data_bit\u304c0\u3068\u306a\u3063\u305f\u6bb5\u968e\u3067\u30ef\u30fc\u30c9\u6570\u3092EventSummaryFIFO\u306b\u66f8\u304d\u8fbc\u3080\u3002 BlockBuffer\u304a\u3088\u3073EventSummaryFIFO\u5185\u306e\u30ef\u30fc\u30c9\u306f\u3053\u306eBuild Process\u3092\u901a\u3058\u3066Builder Bus\u3078\u3068\u9001\u3089\u308c\u308b\u3002</p>"},{"location":"firmware/trg-adc-tdc/trg-adc-tdc/#adc","title":"ADC","text":""},{"location":"firmware/trg-adc-tdc/trg-adc-tdc/#outline_1","title":"Outline","text":"<p>YAENAMI\u306b\u306fADC8\u3064\u3068\u305d\u306e\u4fe1\u53f7\u3092\u30c7\u30b8\u30bf\u30eb\u5316\u3059\u308b\u969b\u306b\u4f7f\u7528\u3055\u308c\u308b\u30af\u30ed\u30c3\u30af\u304c\u5185\u8535\u3055\u308c\u3066\u3044\u308b\u3002 \u3053\u306eADC\u30af\u30ed\u30c3\u30af\u306f\u4e00\u822c\u306bFPGA\u5185\u306e\u30b7\u30b9\u30c6\u30e0\u30af\u30ed\u30c3\u30af\u3068\u540c\u671f\u3057\u3066\u3044\u306a\u3044\u305f\u3081\u3001FPGA\u5185\u3067ADC\u30c7\u30fc\u30bf\u3092\u53d6\u308a\u6271\u3046\u305f\u3081\u306b\u30af\u30ed\u30c3\u30af\u306e\u4e57\u308a\u63db\u3048\u304c\u5fc5\u8981\u3068\u306a\u308b\u3002 \u3053\u306e\u305f\u3081\u30011\u3064\u306eYAENAMI\u304b\u3089\u306f8\u672c\u306e\u30c7\u30fc\u30bf\uff08DATA[7:0]\uff09\u306b\u52a0\u3048\u3001ADC\u30af\u30ed\u30c3\u30af\uff08DCLK\uff09\u304c\u9001\u3089\u308c\u308b\u3002 \u307e\u305f\u3001YAENAMI\u304b\u3089\u306f10\u30d3\u30c3\u30c8ADC\u30c7\u30fc\u30bf\u3092\u30b7\u30ea\u30a2\u30e9\u30a4\u30ba\u3057\u30661\u30d3\u30c3\u30c8\u305a\u3064\u9001\u3063\u3066\u3044\u308b\u305f\u3081\u3001FPGA\u5185\u3067\u3053\u308c\u3092\u30c7\u30b7\u30ea\u30a2\u30e9\u30a4\u30ba\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u3002 \u305d\u306e\u305f\u3081\u306b10\u30d3\u30c3\u30c8\u306e\u5148\u982d\u3092\u793a\u3059\u30d5\u30ec\u30fc\u30e0\u4fe1\u53f7\uff08DFRAME\uff09\u3082\u9001\u3089\u308c\u308b\u3002 \u3055\u3066\u3001FPGA\u3067ADC\u30c7\u30fc\u30bf\u3092\u30b5\u30f3\u30d7\u30ea\u30f3\u30b0\u3059\u308b\u969b\u3001\u4e0b\u56f3\u5de6\u306e\u3088\u3046\u306bDATA\u3042\u308b\u3044\u306fDFRAME\u306e\u5909\u5316\u306e\u30bf\u30a4\u30df\u30f3\u30b0\u304cDCLK\u306e\u7acb\u3061\u4e0a\u304c\u308a\u30fb\u7acb\u3061\u4e0b\u304c\u308a\u306e\u30bf\u30a4\u30df\u30f3\u30b0\u3068\u540c\u6642\u3067\u3042\u308b\u5834\u5408\uff08\u4eca\u56de\u306fDDR (Double Data Rate) \u3092\u7528\u3044\u308b\u306e\u3067\u7acb\u3061\u4e0b\u304c\u308a\u3067\u3082\u30b5\u30f3\u30d7\u30ea\u30f3\u30b0\u304c\u884c\u308f\u308c\u308b\uff09\u3001\u30c7\u30fc\u30bf\u304c\u5b89\u5b9a\u3057\u3066\u3044\u306a\u3044\u30bf\u30a4\u30df\u30f3\u30b0\u3067\u30b5\u30f3\u30d7\u30ea\u30f3\u30b0\u3092\u884c\u3063\u3066\u3057\u307e\u3046\u305f\u3081\u6b63\u3057\u3044\u30c7\u30fc\u30bf\u53d6\u5f97\u304c\u3067\u304d\u306a\u3044\u3002 \u305d\u3053\u3067\u3001\u4e0b\u56f3\u53f3\u306e\u3088\u3046\u306bDATA\u304c\u5b89\u5b9a\u3057\u305f\u30bf\u30a4\u30df\u30f3\u30b0\u3067\u30b5\u30f3\u30d7\u30ea\u30f3\u30b0\u3092\u884c\u3046\u305f\u3081\u3001\u9069\u5207\u306bDATA\u3068DFRAME\u3092\u9045\u5ef6\u3055\u305b\u308b\u5fc5\u8981\u3082\u3042\u308b\u3002</p> Figure\u00a06: Sampling timing (left: w/o delay, right: w/ proper delay) <p>\u4ee5\u4e0a\u3092\u307e\u3068\u3081\u308b\u3068\u3001ADCBlock\u306e\u76ee\u7684\u306f4\u3064\u306eYAENAMI\u304b\u3089\u9001\u3089\u308c\u3066\u304f\u308b\u4fe1\u53f7DATA[31:0]\u3001DCLK[3:0]\u3001DFRAME[3:0]\u3092\u5165\u529b\u3068\u3057\u3001\u30af\u30ed\u30c3\u30af\u306e\u4e57\u308a\u63db\u3048\u3068\u30c7\u30fc\u30bf\u306e\u9069\u5207\u306a\u9045\u5ef6\u3001\u30c7\u30b7\u30ea\u30a2\u30e9\u30a4\u30ba\u3092\u884c\u3046\u3053\u3068\u3067\u3042\u308b\u3002 \u5b9f\u969b\u306b\u306f\u3001\u5dee\u52d5\u5165\u529b\u3067\u3042\u308b\u305f\u3081\u6b63\u6975\u6027\u306e\u4fe1\u53f7DATA_P\u3001DCLK_P\u3001DFRAME_P\u3068\u8ca0\u6975\u6027\u306e\u4fe1\u53f7DATA_N\u3001DCLK_N\u3001DFRAME_N\u304c\u5165\u529b\u3068\u306a\u3063\u3066\u3044\u308b\u3002</p>"},{"location":"firmware/trg-adc-tdc/trg-adc-tdc/#structure-of-adcblock","title":"Structure of ADCBlock","text":"<p>ADCBlock\u306e\u69cb\u9020\u3092\u4e0b\u56f3\u306b\u793a\u3059\u3002</p> Figure\u00a07: ADC structure (AdcBlock.vhd) <p>\u5404\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u306e\u5f79\u5272\u306f\u4ee5\u4e0b\u306e\u901a\u308a:</p> <ul> <li>IBUFDS: \u5dee\u52d5\u5165\u529b\u30d0\u30c3\u30d5\u30a1\u3002FPGA\u5916\u90e8\u304b\u3089\u306e\u5dee\u52d5\u5165\u529b\u4fe1\u53f7\u3092\u30b7\u30f3\u30b0\u30eb\u30a8\u30f3\u30c9\u4fe1\u53f7\u306b\u3057\u3066FPGA\u5185\u306b\u51fa\u529b\u3002</li> <li>BUFIO: \u30af\u30ed\u30c3\u30af\u30d0\u30c3\u30d5\u30a1\u3001\u3059\u306a\u308f\u3061\u5165\u529b\u4fe1\u53f7\u3068\u540c\u3058\u5468\u6ce2\u6570\u306e\u30af\u30ed\u30c3\u30af\u3092FPGA\u5185\u306e\u4e00\u90e8\u9818\u57df\u306b\u5206\u914d\u3059\u308b\u3002</li> <li>BUFR: BUFIO\u306b\u5206\u5468\u306e\u6a5f\u80fd\u304c\u3064\u3044\u305f\u3082\u306e\u3002\u4eca\u56de\u306f1/5\u3067\u5206\u5468\u3092\u884c\u306a\u3063\u3066\u3044\u308b\u3002\u30af\u30ed\u30c3\u30af\u306e\u4e57\u305b\u66ff\u3048\u3084\u30c7\u30b7\u30ea\u30a2\u30e9\u30a4\u30ba\u306b\u4f7f\u7528\u3055\u308c\u308b\u3002</li> <li>IDELAY: \u5165\u529b\u4fe1\u53f7\u306e\u9045\u5ef6\u306b\u4f7f\u7528\u3002\u5165\u529b\u306eREFCLK\u306e\u5024200/300/400 MHz\u306b\u5fdc\u3058\u306678/58/39 ps\u5358\u4f4d\u306e\u9045\u5ef6\u30925\u30d3\u30c3\u30c8\u306etap\u5024\uff08\u6700\u592732tap\uff09\u3067\u8abf\u6574\u3067\u304d\u308b\u3002\u4eca\u56de\u306f200 MHz REFCLK\u306a\u306e\u306778 ps\u5358\u4f4d\u3067\u9045\u5ef6\u3092\u304b\u3051\u3066\u3044\u308b\u3002</li> <li>ISERDES: \u30b7\u30ea\u30a2\u30eb\u5165\u529b\u3092\u30c7\u30b7\u30ea\u30a2\u30e9\u30a4\u30ba\u3057\u3066\u30d1\u30e9\u30ec\u30eb\u51fa\u529b\u3092\u5f97\u308b\u3002\u3053\u3053\u3067\u306f1\u30d3\u30c3\u30c8\u305a\u306410\u56de\u9001\u3089\u308c\u3066\u304f\u308b\u30b7\u30ea\u30a2\u30eb\u306aADC\u30c7\u30fc\u30bf\u309210\u30d3\u30c3\u30c8\u306e\u30c7\u30fc\u30bf\u306b\u5909\u63db\u3059\u308b\u30021:10\u306e\u30d1\u30e9\u30ec\u30eb\u5909\u63db\u3092\u884c\u3046\u305f\u3081\u30012\u3064\u306eISERDES\u3092\u5229\u7528\uff08UG471 p.156\u53c2\u7167\uff09\u3002</li> <li>VIO ADC: JTAG\u7d4c\u7531\u3067FPGA\u5185\u90e8\u306e\u4fe1\u53f7\u306e\u8aad\u307f\u51fa\u3057\u3001FPGA\u5185\u90e8\u30ec\u30b8\u30b9\u30bf\u3078\u306e\u4fe1\u53f7\u306e\u66f8\u304d\u8fbc\u307f\u3092\u884c\u3046\u3002en_ext_tapin\u30921\u306b\u8a2d\u5b9a\u3059\u308b\u3068\u5916\u90e8tap\u304c\u6709\u52b9\u5316\u3055\u308c\u3001defRayrawAdcROV1.vhd\u5185\u306b\u3042\u3089\u304b\u3058\u3081\u8a18\u8ff0\u3055\u308c\u3066\u3044\u308btap\u5024\u304c\u4f7f\u7528\u3055\u308c\u3001en_ext_tapin\u304c0\u306e\u5834\u5408\u306b\u306fVIO\u3067\u8a2d\u5b9a\u3057\u305ftap\u5024\u304c\u4f7f\u7528\u3055\u308c\u308b\u3002</li> <li>ADC CDC FIFO: \u30af\u30ed\u30c3\u30af\u3092ADC\u30af\u30ed\u30c3\u30af\u304b\u3089\u30b7\u30b9\u30c6\u30e0\u30af\u30ed\u30c3\u30af\u306b\u4e57\u308a\u63db\u3048\u308b\u305f\u3081\u306eFIFO\u3002</li> <li>EventBuild Part: MTDC\u306e\u9805\u76ee\u306b\u8a18\u8ff0\u3057\u305f\u901a\u308a\u3002</li> </ul> <p>\u307e\u305f\u56f3\u306b\u306f\u793a\u3057\u3066\u3044\u306a\u3044\u304c\u3001YaenamiAdc.vhd\u5185\u306b\u306fISERDES\u306b\u5165\u529b\u3059\u308bbitslip\u3092\u5236\u5fa1\u3059\u308b\u30b9\u30c6\u30fc\u30c8\u30de\u30b7\u30f3\u304c\u3042\u308b\u3002 1\u30d3\u30c3\u30c8\u306e\u7cfb\u5217\u309210\u30d3\u30c3\u30c8\u30c7\u30fc\u30bf\u306b\u30c7\u30b7\u30ea\u30a2\u30e9\u30a4\u30ba\u3059\u308b\u969b\u3001\u5143\u306e10\u30d3\u30c3\u30c8\u30c7\u30fc\u30bf\u30920~9\u30d3\u30c3\u30c8\u56de\u8ee2\u3055\u305b\u305f\u3082\u306e\u304c\u51fa\u529b\u3055\u308c\u308b\u3002 ISERDES\u304b\u3089\u306e\u51fa\u529b\u304c\u5143\u306e10\u30d3\u30c3\u30c8\u30c7\u30fc\u30bf\u306b\u4e00\u81f4\u3059\u308b\u3088\u3046\u306b\u8abf\u6574\u3059\u308b\u305f\u3081\u4f7f\u7528\u3059\u308b\u306e\u304cbitslip\u3067\u3042\u308b\u3002 tap\u5024\u304c\u9069\u5207\u3067\u3042\u308c\u3070\u30d5\u30ec\u30fc\u30e0\u4fe1\u53f7\u306f\u5e38\u306b0x300 (1100000000) \u306b\u306a\u308b\u3079\u304d\u306a\u306e\u3067\u3001\u5165\u529b\u3092DFRAME\u3068\u3059\u308bISERDES\u306e\u51fa\u529b\u304c\u3053\u308c\u306b\u4e00\u81f4\u3059\u308b\u307e\u3067bitslip\u3092\u5909\u5316\u3055\u305b\u306610\u30d3\u30c3\u30c8\u51fa\u529b\u309210\u56de\u56de\u8ee2\u3055\u305b\u308b\u3002 ISERDES\u306e\u51fa\u529b\u30d5\u30ec\u30fc\u30e0\u4fe1\u53f7\u304c\u5b89\u5b9a\u3057\u3066\uff0816\u56de\u9023\u7d9a\u3067\uff090x300\u306b\u4e00\u81f4\u3059\u308c\u3070\u305d\u306ebitslip\u3092\u63a1\u7528\u3059\u308b\u3002</p> <p>\u6700\u7d42\u7684\u306b\u306f\u4ee5\u4e0b\u306e32\u30d3\u30c3\u30c8\u306eADC\u30ef\u30fc\u30c9\u304c1\u30a4\u30d9\u30f3\u30c8\u3042\u305f\u308aTimeWindow\u3068\u540c\u3058\u6570\u3060\u3051\u5f97\u3089\u308c\u308b\uff1a</p> <pre><code>ADC = magic word (4-bits) &amp; adc_ch (5-bits) &amp; \"00\" &amp; coarse_counter (11-bits) &amp; ADC (10-bits)\n</code></pre> <p>ADC\u306emagic word\u306f<code>X\"a\"</code>\u3067\u3042\u308b\u3002</p>"},{"location":"firmware/trg-adc-tdc/trg-adc-tdc/#note-iserdes","title":"Note: ISERDES","text":"<p>\u6700\u5f8c\u306bISERDES\u306b\u3088\u308b\u30c7\u30b7\u30ea\u30a2\u30e9\u30a4\u30ba\u306e\u904e\u7a0b\u3092\u5927\u307e\u304b\u306b\u8ff0\u3079\u3066\u304a\u304f\u3002 \u4e0b\u56f3\u306bISERDE\u5165\u529b\u3001ISERDES\u5185\u90e8\u3001ISERDES\u51fa\u529b\u306e\u30bf\u30a4\u30df\u30f3\u30b0\u30c1\u30e3\u30fc\u30c8\u3092\u793a\u3059\u3002 \u4eca\u56de\u306f1:10\u306e\u30c7\u30b7\u30ea\u30a2\u30e9\u30a4\u30ba\u306e\u305f\u3081ISERDES\u30922\u3064\u4f7f\u7528\u3057\u3066\u3044\u308b\u305f\u3081\u3001\u5b9f\u969b\u306e\u30bf\u30a4\u30df\u30f3\u30b0\u30c1\u30e3\u30fc\u30c8\u306f\u3053\u308c\u3068\u306f\u7570\u306a\u308b\u304c\u3001\u52d5\u4f5c\u81ea\u4f53\u306f\u5927\u540c\u5c0f\u7570\u306a\u306e\u3067\u3053\u306e\u56f3\u3067\u8aac\u660e\u3092\u9032\u3081\u308b\u3002 \u307e\u305a\u3001ISERDES\u3078\u306e\u5165\u529b\u306fADC\u30af\u30ed\u30c3\u30af\u3068\u540c\u4e00\u5468\u6ce2\u6570\u306e\u901f\u3044\u30af\u30ed\u30c3\u30af\u306b\u3088\u308a\u3001ISERDES\u5185\u90e8\u3067DDR\u3067\u30b5\u30f3\u30d7\u30ea\u30f3\u30b0\u3055\u308c\u308b\uff08\u56f3\u306e\u9752\u70b9\u7dda\uff09\u3002 \u3053\u306e\u4e2d\u9593\u30c7\u30fc\u30bf\u304c\u9045\u3044\u30af\u30ed\u30c3\u30af\u306e\u5468\u671f\u3068\u540c\u3058\u3067\u3042\u308c\u3070\u3001\u6a59\u70b9\u7dda\u306e\u30bf\u30a4\u30df\u30f3\u30b0\u3067\u540c\u6642\u306b10\u30d3\u30c3\u30c8\u3092\u8aad\u307f\u51fa\u3059\u3053\u3068\u304c\u3067\u304d\u308b\u3002</p> Figure\u00a08: Timing chart of ISERDES"},{"location":"firmware/trg-adc-tdc/trg-adc-tdc/#trm","title":"TRM","text":"<p>\u30c7\u30fc\u30bf\u53d6\u5f97\u306e\u30c8\u30ea\u30ac\u30fc\u306fTDC\u306e\u30e2\u30b8\u30e5\u30fc\u30eb\u5185\u3067\u4f5c\u3089\u308c\u308bCommon Stop\u3067\u3042\u308a\u3001Common Stop\u306fIOM\u3067\u6307\u5b9a\u3057\u305fExtL1\u304b\u3089\u4f5c\u3089\u308c\u308b\u3002 \u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u8a2d\u5b9a\u3067\u306f\u3001TRM\u306eSelectTrigger[0]\u3092\"1\"\u306b\u3057\u3001DCT\u306eDaqGate\u3092\"1\"\u306b\u3057\u305f\u72b6\u614b\u3067\u3001ExtL1(NIMIN1)\u306bH\u306e\u4fe1\u53f7\u3092\u9001\u308b\u3053\u3068\u3067\u30c7\u30fc\u30bf\u3092\u53d6\u5f97\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u3002</p>"},{"location":"firmware/trg-adc-tdc/trg-adc-tdc/#busy","title":"BUSY\u3068\u306a\u308b\u30bf\u30a4\u30df\u30f3\u30b0","text":"<p>BUSY\u4fe1\u53f7(module busy)\u3092\u5185\u90e8\u3067\u4f5c\u3063\u3066\u3001NIMOUT\u306b\u51fa\u529b\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u308b\u3002 \u305f\u3060\u3057NIMIN\u306bBUSY\u3068\u3057\u3066\u5165\u529b\u3055\u305b\u3066\u3082Firmware\u5185\u3067\u306f\u4f7f\u308f\u308c\u3066\u3044\u306a\u3044\u306e\u3067\u3001Trigger\u3092\u51fa\u3059NIM\u30e2\u30b8\u30e5\u30fc\u30eb\u306a\u3069\u306bVeto\u4fe1\u53f7\u3068\u3057\u3066\u7528\u3044\u308b\u3053\u3068\u3092\u63a8\u5968\u3059\u308b\u3002 BUSY\u4fe1\u53f7\u306f\u4ee5\u4e0b\u306e\u4fe1\u53f7\u306eOR\u3068\u306a\u3063\u3066\u3044\u308b\u3002</p> \u7a2e\u985e \u9577\u3055 \u5099\u8003 Self Busy 200 ns L1 trigger\u3092\u691c\u51fa\u3057\u305f\u77ac\u9593\u304b\u3089\u56fa\u5b9a\u9577\u3067\u30a2\u30b5\u30fc\u30c8\u3002 Sequence Busy ADC\u3001TDC\u306eBuffer\u3084FIFO\u304cFull\u306b\u306a\u308b\u3068\u30a2\u30b5\u30fc\u30c8\u3055\u308c\u307e\u3059\u3002\u307e\u305f\u3001Common Stop\u3092\u767a\u884c\u3057\u3066\u304b\u3089\u8a2d\u5b9a\u3057\u305fTime Window\u5206\u306eRing Buffer\u5185\u306e\u30c7\u30fc\u30bf\u8aad\u307f\u51fa\u3057\u304c\u7d42\u308f\u308b\u307e\u3067\u30a2\u30b5\u30fc\u30c8\u3055\u308c\u307e\u3059\u3002 FIFO Busy \u4f7f\u308f\u308c\u3066\u3044\u306a\u3044\u3002"},{"location":"hardware/rayraw-v1/rayraw-v1/","title":"RAYRAW-v1","text":"<p>The RAYRAW version 1 is a general purpose SiPM readout electronics using YAENAMI ASICs. The board was designed to evaluate the YAENAMI ASICs, but this has enough functionaries to be used in a physics experiment.</p> <ul> <li>Manufacturer: \u6709\u9650\u4f1a\u793e\u30b8\u30fc\u30fb\u30a8\u30cc\u30fb\u30c7\u30a3\u30fc</li> <li>Product No: GN-2226-1</li> </ul> <p>The figure shows the photograph of the RAYRAW-v1 board. In this section, the author calls the RAYRAW-v1 as RAYRAW. This is a 140 mm x 200 mm sized readout board with a SiPM input connector (HIROSE FX2B-68PA-1.27DSL(71)). The connection between the input connector and ASICs is described in the SiPM input sub-section. RAYRAW has a SFP+ port for a data link, a JTAG port, NIM IO, test input port, bias supply port, a MIKUMARI port for clock synchronization, and a power connector. In addition, an multiplexed analog output from each ASIC can be monitored via through holes near by the ASIC. The comparator (discriminator) parallel outputs from YAENAMIs are once fed into an FPGA, and then the copy of those signals are output from the \"Comparator outputs\" connector. The FPGA mounted on the board is AMD Xilinx Kintex-7 FPGA (XC7K-160T-2FFG676C), which is the same as that of AMANEQ. This board has the same a jitter (CDCE62002) as that on AMANEQ. Thus, the digital part of RAYRAW is based on the design of AMANEQ, it uses many same ICs. RAYRAW also has dedicated functionalities for operating SiPMs, i.e., an APD bias supply IC (MAX19232ETC+T). Please also see the AMANEQ user guide and the RAYRAW user guide.</p> Figure\u00a01: Picture of RAYRAW-v1 GN-2226-1 <p>The specification is summarized as follows.</p> <ul> <li>Size: 140 mm (H) x 200 mm (V)</li> <li>MPPC input<ul> <li>128ch in total</li> <li>Connector: FX2B-68PA-1.27DSL(71)</li> </ul> </li> <li>ASIC: KEK E-sys YAENAMI x4</li> <li>Bias: MAX1932ETC+T<ul> <li>Supply range: 40-70V (256 steps)</li> <li>Maximum output current: 2.5 mA</li> </ul> </li> <li>Test inpout<ul> <li>1.2 square wave input from a LEMO connector</li> </ul> </li> <li>Analog outputs:<ul> <li>Differential output from each ASIC</li> </ul> </li> <li>Parallel comparator (discriminator) outputs<ul> <li>KEL 8831E-068-170-F</li> <li>User can select ground position from K-type (KEK) and L-type (LeCroy). Default is K-type, and if you need an L-type RAYRAW, please specify it when ordering.</li> </ul> </li> <li>FPGA: AMD Xilinx XC7K-160T-2FFG676C</li> <li>Flash memory: CYPRESS S25FL128SAGMFIR01</li> <li>Data links: SFP+ (10 Gbps in maximum)<ul> <li>Link media depends on the type of SFP modules.</li> </ul> </li> <li>Clock synchronization: One MIKUMARI port (SFP)</li> <li>Num of NIM input: 2 (LEMO)</li> <li>Num of NIM output: 2 (LEMO)</li> <li>Power supply: 20-35V DC<ul> <li>Jack: 2.10mm ID, 5.50mm OD</li> <li>Main connector: \u65e5\u672c\u5727\u7740\u7aef\u5b50 S2P-VH(LF)(SN)</li> <li>Note that the connector is different from that on AMANEQ</li> </ul> </li> <li>Fuse limit: 1A<ul> <li>Fuse product: Littelfuse 0251001.NRT1L</li> </ul> </li> <li>Num of DIP switch bits: 8</li> <li>Clock generator IC: TI CDCE62002</li> </ul> Figure\u00a02: Block diagram of GN-2226-1 <p>MPPCs are biased by the MAX1932 bias supply, which is controlled by FPGA. It can control output voltage with 256 steps between 40V to 70V. The MPPC signal lines are parallel terminated with 100 ohm registers together with 0.22 uF capacitances for DC blocking. The MPPC signals are fed into four YAENAMIs, and are amplified, shaped, and discriminated in YAENAMI. The shaped analog signal is digitized by ADC in YAENAMI, and the digitized data are transferred to FPGA channel by channel. For details of this YAENAMI, please see the ASIC section. The comparator (discriminator) outputs are also input in parallel to the FPGA.</p> <p>The YAENAMI is a free-run digitizer for a timing and a waveform; it continuously provides the waveform data and the comparator signals without any trigger signal. The board is designed to implement the streaming readout ADC and TDC functions, but if users implement a triggered-type DAC function in FPGA, it can work as the triggered-type ADC and TDC. The RAYRAW board equips the SFP port for synchronization, which is expected to be used for the MIKUMARI link protocol.</p>"},{"location":"hardware/rayraw-v1/rayraw-v1/#board-interface","title":"Board interface","text":""},{"location":"hardware/rayraw-v1/rayraw-v1/#sipm-input","title":"SiPM input","text":"Figure\u00a03: Schematic drawing for the CN1, MPPC input connector. <p>The figure is the schematic drawing for the MPPC input connector (CN1). The electrodes under the position marker are assigned as A1 and B1. The connection between CN1 and FPGA is summarized as follows. Arrangement to the CN5 for which the comparator outputs is listed.</p> CN1 (HIROSE) MPPC-IN-NET ASIC NUM ASIC IN FPGA IN CN5 (KEL pos side) CN5 (KEL neg side) B32 0 U16 7 0 A3 A4 A32 1 U16 6 1 A5 A6 B30 2 U16 5 2 A7 A8 A30 3 U16 4 3 A9 A10 B28 4 U16 3 4 A11 A12 A28 5 U16 2 5 A13 A14 B26 6 U16 1 6 A15 A16 A26 7 U16 0 7 A17 A18 B24 8 U17 7 8 A19 A20 A24 9 U17 6 9 A21 A22 B22 10 U17 5 10 A23 A24 A22 11 U17 4 11 A25 A26 B20 12 U17 3 12 A27 A28 A20 13 U17 2 13 A29 A30 B18 14 U17 1 14 A31 A32 A18 15 U17 0 15 A33 A34 B16 16 U18 7 16 B3 B4 A16 17 U18 6 17 B5 B6 B14 18 U18 5 18 B7 B8 A14 19 U18 4 19 B9 B10 B12 20 U18 3 20 B11 B12 A12 21 U18 2 21 B13 B14 B10 22 U18 1 22 B15 B16 A10 23 U18 0 23 B17 B18 B08 24 U19 7 24 B19 B20 A08 25 U19 6 25 B21 B22 B06 26 U19 5 26 B23 B24 A06 27 U19 4 27 B25 B26 B04 28 U19 3 28 B27 B28 A04 29 U19 2 29 B29 B30 B02 30 U19 1 30 B31 B32 A02 31 U19 0 31 B33 B34"},{"location":"hardware/rayraw-v1/rayraw-v1/#mppc-bias","title":"MPPC bias","text":"Figure\u00a04: MPPC bias supply. <p>MAX1932 can output bias voltage between 40V-70V with 256 steps, and it is controllable by FPGA through the network. Bias voltage is output from the left side LEMO connector.</p> <p>The maximum output current is 2.5 mA.</p>"},{"location":"hardware/rayraw-v1/rayraw-v1/#test-input","title":"Test input","text":"<p>The right side LEMO connector in the figure is a test input. Please input 1.2V square wave with the pulse width longer than 1us, and thus a constant amount of charge injected to all the ASIC pre-amplifiers in ASIC at the square wave edges. As it is not possible to inject arbitral amount of charge, this test input cannot be used for the calibration. This input is common to all the ASICs.</p>"},{"location":"hardware/rayraw-v1/rayraw-v1/#analog-monitor","title":"Analog monitor","text":"<p>An multiplexed analog output from each ASIC can be monitored via through holes near by the ASIC. Please specify the target channel by slow control. Please use a differential probe to read it. If you don't have it, please read a positive side using a passive probe. This analog monitor port cannot drive a 50 ohm termination.</p>"},{"location":"hardware/rayraw-v1/rayraw-v1/#sfp-1","title":"SFP-1","text":"<p>The SFP-1 port is for a data link of which the speed is 10 Gbps in maximum. The SFP and SFP+ modules are applicable but the link speed depends on firmware. As this port is the same as that on AMANEQ, please also see the AMANEQ user guide.</p>"},{"location":"hardware/rayraw-v1/rayraw-v1/#dip","title":"DIP","text":"Figure\u00a05: DIP switch <p>The DIP switch is set to the left side where \"ON\" is printed, a logic 0 is taken in the FPGA. The function of each bit depends on each firmware.</p>"},{"location":"hardware/rayraw-v1/rayraw-v1/#led","title":"LED","text":"Figure\u00a06: LEDs <p>There is an LED indicating FPGA configuration done near by the FPGA. This LED lights up when the FPGA configuration is complete. There are other four LEDs. What the LED indicates depends on the firmware.</p>"},{"location":"hardware/rayraw-v1/rayraw-v1/#nim","title":"NIM","text":"<p>The NIM output of RAYRAW uses a simplified method for converting to the NIM signal standard, and there are differences in the voltage recognized as logic-high among boards. For this reason, even if the NIM output is made with the same firmware, the signal width and timing may appear slightly different. It is not suitable for output of high-precision signals where timing is important. The two NIM1 and NIM2 are printed on the silk screen on the board.</p>"},{"location":"hardware/rayraw-v1/rayraw-v1/#power-supply","title":"Power supply","text":"<p>The power supply connector is \u65e5\u672c\u5727\u7740\u7aef\u5b50 S2P-VH(LF)(SN). There is a rule for power on/off process. Please see the AMANEQ user guide.</p>"},{"location":"hardware/rayraw-v1/rayraw-v1/#mikumari-port-sfp-2","title":"MIKUMARI port (SFP-2)","text":"<p>This is the same that of the AMANEQ. Please see the AMANEQ user guide.</p>"},{"location":"hardware/rayraw-v1/rayraw-v1/#board-ics","title":"Board ICs","text":"<p>The FPGA, the jitter cleaner IC, and the flash memory are the same those on AMANEQ. Please see the AMANEQ user guide.</p>"},{"location":"hardware/rayraw-v1/rayraw-v1/#power-supply-ics","title":"Power supply ICs","text":"Figure\u00a07: 3.3V power IC <p>The external DC voltage supply of 35V RAYRAW uses the LT8612UDE to step down the external input of 35V to 5V, and then further steps it down to multiple power supply voltages. A test pint are located near by each power supply IC as shown in the figure. Please confirm that every output voltage is correct after board delivery.</p> Silk print Voltage Parts number Test pint number +5V +5.0V U38 Nothing +3V3D +3.3V U34 TP21 +1V8D +1.8V U33 TP20 +1V0D +1.0V U32 TP19 +1V8GTX +1.8V U37 TP24 +1V2GTX +1.2V U35 TP23 +1V05GTX +1.05V U36 TP22 -3V3D -3.0V U7 Nothing +3V3A +3.3V U31 TP17 +1V2A +1.2V U30 TP18"},{"location":"practical/practical/","title":"Practical usage","text":"<p>Please read the AMANEQ user guide. All the things written in the AMANEQ practical section are also important for CIRASAME.</p>"},{"location":"practical/practical/#cdce62002-initialization","title":"CDCE62002 initialization","text":"<p>Currently, the initialization of CDCE62002 at first power-on, is not required for CIRASAME since CDCE62002 is not used in the present firmware. It may be required in the future upgrade.</p>"},{"location":"practical/practical/#usage","title":"Usage","text":"<p>\u3053\u3053\u306b\u30c7\u30fc\u30bf\u3092\u53d6\u308c\u308b\u3088\u3046\u306b\u306a\u308b\u307e\u3067\u306e\u624b\u9806\u3092\u66f8\u304f\u3002</p>"},{"location":"release/release/","title":"Release notes","text":""},{"location":"release/release/#jun-4-2024","title":"Jun. 4, 2024","text":""},{"location":"release/release/#new","title":"New","text":"<ul> <li>hogehoge<ul> <li>CIRASAME Skeleton v2.0</li> <li>CIRASAME-StrLRTDC v2.5</li> </ul> </li> </ul>"},{"location":"software/software/","title":"Software","text":"<p>Here, the author describes the hul-common-lib and the rayraw-soft.</p>"},{"location":"software/software/#hul-common-lib","title":"hul-common-lib","text":"<p>Github repository</p> <p>Since the basic structure of The RAYRAW firmware is the same that of AMANEQ's firmware, the RAYRAW board can be controlled by hul-common-lib. Before reading this section, see the AMANEQ user guide. In this user guide, the author additionally explains about programs for RAYRAW.</p>"},{"location":"software/software/#rayraw-soft","title":"rayraw-soft","text":"<p>Github repository</p> <p><code>rayraw-soft</code>\u306fRAYRAW\u306e\u30d5\u30a1\u30fc\u30e0\u30a6\u30a7\u30a2\u5c02\u7528\u306e\u6a5f\u80fd\u3092\u63d0\u4f9b\u3057\u307e\u3059\u3002 \u30b3\u30f3\u30d1\u30a4\u30eb\u3059\u308b\u305f\u3081\u306b\u306f<code>hul-common-lib</code>\u304c\u5fc5\u8981\u3067\u3059\u3002</p>"},{"location":"software/software/#executable-files","title":"Executable files","text":""},{"location":"software/software/#trgfwdaq","title":"TrgFW/daq","text":"<p>Triggered-type ADC multi-hit TDC\u5c02\u7528\u306e\u30c7\u30fc\u30bf\u53ce\u96c6\u7528\u30d7\u30ed\u30b0\u30e9\u30e0\u3067\u3059\u3002 \u5f15\u6570\u3067\u6307\u5b9a\u3057\u305f\u30b5\u30fc\u30c1\u7a93\u3092ADC\u3068TDC\u306b\u8a2d\u5b9a\u3057\u3001\u6307\u5b9a\u3057\u305f\u30a4\u30d9\u30f3\u30c8\u6570\u30c7\u30fc\u30bf\u3092\u53d6\u5f97\u3057\u307e\u3059\u3002 \u6307\u5b9a\u3057\u305f\u30a4\u30d9\u30f3\u30c8\u6570\u53d6\u5f97\u3057\u305f\u5f8c\u81ea\u52d5\u7684\u306b\u30d7\u30ed\u30b0\u30e9\u30e0\u306f\u7d42\u4e86\u3057\u307e\u3059\u304c\u3001<code>Ctr-C</code>\u3067\u5272\u308a\u8fbc\u3093\u3067\u6b62\u3081\u308b\u4e8b\u3082\u53ef\u80fd\u3067\u3059\u3002 \u30d7\u30ed\u30b0\u30e9\u30e0\u3092\u5b9f\u884c\u3057\u305f\u5834\u6240\u306b<code>data</code>\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u304c\u3042\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3001\u3042\u3089\u304b\u3058\u3081\u4f5c\u6210\u3057\u3066\u304a\u3044\u3066\u304f\u3060\u3055\u3044\u3002</p> <p>\u3053\u306e\u30d7\u30ed\u30b0\u30e9\u30e0\u306f1\u53f0\u306e\u30dc\u30fc\u30c9\u304b\u3089\u30c7\u30fc\u30bf\u3092\u53d6\u5f97\u3059\u308b\u305f\u3081\u306e\u7c21\u6613\u7684\u306aDAQ\u30d7\u30ed\u30b0\u30e9\u30e0\u3067\u3059\u3002 \u3053\u306e\u30d7\u30ed\u30b0\u30e9\u30e0\u3092\u4f7f\u3063\u3066\u7269\u7406\u5b9f\u9a13\u3092\u884c\u3046\u4e8b\u306f\u60f3\u5b9a\u3057\u3066\u307e\u305b\u3093\u3002\u5fc5\u305a\u304a\u4f7f\u3044\u306eDAQ\u30bd\u30d5\u30c8\u30a6\u30a7\u30a2\u3078\u6a5f\u80fd\u3092\u79fb\u690d\u3057\u3066\u304f\u3060\u3055\u3044\u3002 \u3053\u306e\u30d7\u30ed\u30b0\u30e9\u30e0\u5185\u3067\u306f</p> <ul> <li>\u30c8\u30ea\u30ac\u30fc\u7a2e\u985e\u306e\u9078\u629e</li> <li>\u30c8\u30ea\u30ac\u30fc\u5165\u529b\u3092NIM-IN1\u3078\u30a2\u30b5\u30a4\u30f3</li> <li>TDC\u3068ADC\u3078\u306e\u30b5\u30fc\u30c1\u7a93\u306e\u8a2d\u5b9a</li> <li>\u30a4\u30d9\u30f3\u30c8\u30ab\u30a6\u30f3\u30bf\u306e\u30ea\u30bb\u30c3\u30c8</li> <li>ADC\u30d6\u30ed\u30c3\u30af\u306e\u521d\u671f\u5316\u72b6\u6cc1\u306e\u78ba\u8a8d</li> </ul> <p>\u3092\u884c\u3063\u3066\u304b\u3089TCP\u63a5\u7d9a\u3092\u884c\u3044\u30c7\u30fc\u30bf\u8aad\u307f\u51fa\u3057\u3092\u958b\u59cb\u3057\u307e\u3059\u3002 \u4e0a\u8a18\u306fRAYRAW\u30dc\u30fc\u30c9\u306e\u5236\u5fa1\u3067\u3042\u308a\u3001\u30c7\u30fc\u30bf\u8aad\u307f\u51fa\u3057\u306e\u30b7\u30fc\u30b1\u30f3\u30b9\u3068\u306f\u72ec\u7acb\u306e\u305f\u30811\u3064\u306e\u30d7\u30ed\u30b0\u30e9\u30e0\u5185\u3067\u5168\u3066\u884c\u3046\u5fc5\u8981\u306f\u672c\u6765\u3042\u308a\u307e\u305b\u3093\u3002 \u3053\u306e\u30d7\u30ed\u30b0\u30e9\u30e0\u3067\u306f\u7c21\u5358\u306e\u305f\u3081\u306b\u5168\u3066\u30921\u3064\u306e\u5b9f\u884c\u4f53\u5185\u3067\u884c\u3063\u3066\u3044\u307e\u3059\u304c\u3001\u79fb\u690d\u306e\u969b\u306b\u306f\u5236\u5fa1\u90e8\u306f\u9069\u5b9c\u5206\u96e2\u3057\u3066\u304f\u3060\u3055\u3044\u3002</p> <pre><code>    [IP]           [Run No] [Num of events] [Window max] [Window min]\ndaq 192.168.10.16  1        10000           500              300\n</code></pre> <p>\u4e0a\u8a18\u306e\u4f8b\u3067\u306f\u30b5\u30fc\u30c1\u7a93\u3092300\u304b\u3089500\u306b\u30bb\u30c3\u30c8\u3057\u300110000\u30a4\u30d9\u30f3\u30c8\u3092<code>./data/run1.dat</code>\u3068\u3044\u3046\u30d5\u30a1\u30a4\u30eb\u3078\u4fdd\u5b58\u3057\u307e\u3059\u3002 \u30b5\u30fc\u30c1\u7a93\u306eLSB\u7cbe\u5ea6\u304a\u3088\u3073\u30d3\u30c3\u30c8\u5e45\u306f\u30d5\u30a1\u30fc\u30e0\u30a6\u30a7\u30a2\u306e\u30b7\u30b9\u30c6\u30e0\u30af\u30ed\u30c3\u30af\u5468\u671f\u306b\u4f9d\u5b58\u3057\u307e\u3059\u3002 \u30d5\u30a1\u30fc\u30e0\u30a6\u30a7\u30a2\u306e\u9805\u76ee\u3092\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\u3002 \u3053\u3053\u3067\u6307\u5b9a\u3057\u305f\u5024\u304cTDC\u3068ADC\u4e21\u65b9\u306b\u5bfe\u3057\u3066\u4f7f\u7528\u3055\u308c\u307e\u3059\u3002 \u30b5\u30fc\u30c1\u7a93\u5024\u306eLSB\u7cbe\u5ea6\u3092A ns\u3068\u3059\u308b\u3068\u3001\u4e0a\u8a18\u4f8b\u3067\u306f\u30b3\u30e2\u30f3\u30b9\u30c8\u30c3\u30d7\u4fe1\u53f7\u304b\u3089\u307f\u3066<code>300*A - 500*A</code>\u79d2\u904e\u53bb\u306e\u30c7\u30fc\u30bf\u304c\u53d6\u5f97\u3067\u304d\u307e\u3059\u3002</p>"},{"location":"software/software/#rayraw-control","title":"rayraw-control","text":"<p>\u3053\u3053\u306brayraw-control\u306e\u4f7f\u3044\u65b9\u3092\u66f8\u304f</p>"}]}